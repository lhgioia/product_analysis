---
title: "Analyzing Moisturizer Ingredient Lists"
output: html_document
---

```{r, echo=FALSE}
knitr::opts_chunk$set(global.par = TRUE)
```

### Introduction

I'm pretty sure skincare companies are just making stuff up. They aren't doing research. They aren't inventing anything. They are only focused on getting people to buy their products. So they put all of their effort and money into marketing and copying the things that other companies have successfully marketed.

I wanted to get a sense of what's actually in these products, and I think just reading the ingredient lists makes it hard to tell what is going on. I know enough chemistry to understand what the ingredient names mean. I know data analysis. So I started by downloading a bunch of ingredient lists so I could compare them. This research has been a roller coaster with many unexpected roadblocks. So buckle up and get ready to jump some hurdles with me.

### Getting the data

First, we have to get some data. I got the best-seller results from [Target](https://www.target.com/) and [Sephora](https://www.sephora.com/), and created a [google sheet](https://docs.google.com/spreadsheets/d/e/2PACX-1vS4wAroj1XvB4aiuOg97IdS6xNd2x0wsylwXOYZZlCAysx3n5SA9Fi3IcLrbWGe_e7cuhzW2_fOl8qj/pubhtml) with each product's brand name, product name, price, size, and product link on [INCIDecoder](https://www.incidecoder.com), which is where we will be scraping the ingredient lists. Sadly, the Target and Sephora websites are difficult to scrape. I had to gather all of the data by hand :( I might try to implement that in the future with [RSelenium](https://docs.ropensci.org/RSelenium/). 

The google sheet is imported using the [googlesheets4 R package](https://googlesheets4.tidyverse.org/). Here are the top few entries:
```{r message=FALSE}
library(googlesheets4)
productSheet <- read_sheet("1LVIoYIZDoDtc26z5JMHpv_7a34aqSZwdFsazG8_JlfY")
kable(head(productSheet, n = 5L))
```

```{r fig.width=8, fig.height=8, warning=FALSE, error=FALSE, message=FALSE, echo=FALSE}
library(here)
library(rvest)
library(gplots)
library(RColorBrewer)
library(Rtsne)
library(ggplot2)
library(ggrepel)
library(dplyr)

par(mar=c(1,1,1,1))
par(oma=c(1,1,1,1))
par(cex.main = 1.5)

#### read moisturizer data (generated with getMoisturizerData.R) ####
## TODO reformat column names then remove check.names=FALSE
# read and format data
moistData <- read.csv(paste0(here(), "/data/moisturizer_data.csv"), check.names = FALSE)

prods <- subset(moistData, select = -c(BRAND_NAME, PRODUCT_NAME, PRICE, SIZE, PRICE_PER_OZ, STORE))
prods$product <- paste(moistData$BRAND_NAME, moistData$PRODUCT_NAME)
# move product column to first column
prods <- relocate(prods, product)

# keep ingredients that are used by more than one product
ingCols <- prods[,-1]
ingShared <- ingCols[, which(colSums(ingCols) > 1)]
# prodsIngShared <- cbind(prods$product, ingShared)
# names(prodsIngShared)[1] <- "product"

row.names(ingShared) <- prods$product



```